@use "sass:list";
@use "sass:map";

@use "builder.call-mixin" as *;
@use "configuration";
@use "helpers" as *;

@use "meta/custom-props-from-maps" as *;
@use "meta/data-debug-space" as *;
@use "meta/data-debug" as *;
@use "meta/data-line" as *;

@use "preflight/custom-tailwind-base" as *;
@use "preflight/modern-normalize" as *;
@use "preflight/vendored-font-smoothing" as *;

// TODO: Group typography for simplicity for now.

// @use "core/typography-white-space" as *;
// @use "core/typography-text-align" as *;
// @use "core/typography-vertical-align" as *;
// @use "core/typography-font-size" as *;

// @at-root {
// 	@include typography-white-space(core);
// 	@include typography-text-align(core);
// 	@include typography-vertical-align(core);
// 	@include typography-font-size(core);
// }

@at-root {
	@if not configuration.$headless {
		/*! duomo | MIT License | https://github.com/zaydek/duomo */

		/* purgecss start ignore */
		@include modern-normalize;
		@include custom-tailwind-base;
		@include vendored-font-smoothing;
		/* purgecss end ignore */

		@if configuration.$debugger {
			@include data-debug;
			@include data-debug-space;
		}
		@if configuration.$stagger {
			@include data-line;
		}

		// prettier-ignore
		@include custom-props-from-maps(
			(shorthand: none, map: fonts($raw: true)),
			(shorthand: none, map: colors($raw: true)),
			(shorthand: shadow, map: shadows($raw: true)),
			(shorthand: none, map: timings($raw: true)),
			(shorthand: breakpoint, map: breakpoints($raw: true)),
		);

		// TODO: Add `take` pattern here.
		@each $mk, $mv in configuration.$variants {
			@if $mk != directives {
				@include call-mixin($mk, var-join(core, take($mv, responsive))...);
			}
		}
		@each $mk, $mv in configuration.$variants {
			@if $mk != directives {
				@if list.index($mv, responsive) {
					@include call-mixin($mk, responsive);
				}
			}
		}
		// NOTE: `directives` must be last.
		@if map.get(configuration.$variants, directives) {
			@include call-mixin(directives, var-join(core, map.get(configuration.$variants, directives))...);
		}
	}
}
