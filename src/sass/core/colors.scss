@use "sass:list";
@use "sass:map";

@use "../utils2";

@function __new-rgba-map($map, $alpha-channel) {
	$merged: ();

	@each $k, $v in $map {
		$to-merge: ();
		@if $v == transparent or $v == currentColor {
			$to-merge: (#{$k}: #{$v});
		} @else {
			$to-merge: (#{$k}: rgba(list.nth($v, 1), list.nth($v, 2), list.nth($v, 3), #{$alpha-channel}));
		}
		$merged: map.merge($merged, $to-merge);
	}

	@return $merged;
}

@mixin __generate-colors($shorthand, $prop, $map, $alpha-range) {
	$amp: utils2.get-ampersand();

	@each $k, $v in __new-rgba-map($map, var(--#{$shorthand}-opacity)) {
		#{$amp}#{$shorthand}-#{$k} {
			--#{$shorthand}-opacity: 1;
			#{$prop}: #{rgb(map.get($map, $k)...)};
			#{$prop}: #{$v};
		}
	}
	@each $v in $alpha-range {
		#{$amp}#{$shorthand}-opacity-#{$v * 100} {
			--#{$shorthand}-opacity: #{$v};
		}
	}
}

@mixin color($map, $alpha-range) {
	@include __generate-colors("text", color, $map, $alpha-range);
}

@mixin background-color($map, $alpha-range) {
	@include __generate-colors("bg", background-color, $map, $alpha-range);
}

// TODO: Possibly move to `border` submodule.
@mixin border-color($map, $alpha-range) {
	@include __generate-colors("border", border-color, $map, $alpha-range);
}
